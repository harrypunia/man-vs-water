var bulletSize;THREE.PlayerControls=function(t,e,i,o){function s(){g.moveSpeed>v&&(g.moveSpeed-=.01),"Speedy"==this.playerType?g.turnSpeed<.1&&(g.turnSpeed+=.001):"Tank"==this.playerType?g.turnSpeed<.05&&(g.turnSpeed+=.001):g.turnSpeed<.07&&(g.turnSpeed+=.001),this.sprinting=!1}function a(){(S=document.getElementsByClassName("stamina")[0]).style.borderLeft=R/100*300+"px solid #4e7fdd"}function n(){return 2*Math.PI/60/60*g.autoRotateSpeed}function h(){return Math.pow(.95,g.userZoomSpeed)}function p(t){!1!==g.enabled&&(t.preventDefault(),B===Z.ROTATE?(O.set(t.clientX,t.clientY),P.subVectors(O,b),g.rotateLeft(2*Math.PI*P.x/D*g.userRotateSpeed),g.rotateUp(2*Math.PI*P.y/D*g.userRotateSpeed),b.copy(O)):B===Z.ZOOM&&(L.set(t.clientX,t.clientY),k.subVectors(L,V),k.y>0?g.zoomIn():g.zoomOut(),V.copy(L)))}function r(t){!1!==g.enabled&&!1!==g.userRotate&&(document.removeEventListener("mousemove",p,!1),document.removeEventListener("mouseup",r,!1),B=Z.NONE)}function l(t){if(!1!==g.enabled&&!1!==g.userRotate){var e=0;t.wheelDelta?e=t.wheelDelta:t.detail&&(e=-t.detail),e>0?g.zoomOut():g.zoomIn()}}this.camera=t,this.player=e,this.domElement=void 0!==o?o:document,this.enabled=!0,this.allow=!0,this.playerType=i,this.center=new THREE.Vector3(e.position.x,e.position.y,e.position.z),this.hasLanded=!1,this.sprinting=!1,this.allowSprinting=!0,this.jumping=!1,this.jump=!1,this.gravity=.007,this.allowMouseControls;var m,d,c,y,u,S,v,w,E,M=10,x=20,z=document.getElementById("bulletCountDisplay"),R=100,T=.15;document.getElementById("map");this.reloading=!1,this.moveSpeed,this.acceleration,this.maxSpeed,this.turnSpeed,this.staminaDrain,this.staminaRecovery,this.sprintTurnSpeed,this.userZoom=!0,this.userZoomSpeed=1,this.perspective=7,this.userRotate=!0,this.userRotateSpeed=1.5,this.autoRotate=!1,this.autoRotateSpeed=.3,this.YAutoRotation=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minDistance=0,this.maxDistance=1/0;var f,g=this,D=1800,b=new THREE.Vector2,O=new THREE.Vector2,P=new THREE.Vector2,V=new THREE.Vector2,L=new THREE.Vector2,k=new THREE.Vector2,H=0,A=0,I=1,N=new THREE.Vector3(e.position.x,e.position.y,e.position.z),j=!1,C={},Z={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},B=Z.NONE;this.rotateLeft=function(t){void 0===t&&(t=n()),A-=t},this.rotateRight=function(t){void 0===t&&(t=n()),A+=t},this.rotateUp=function(t){void 0===t&&(t=n()),H-=t},this.rotateDown=function(t){void 0===t&&(t=n()),H+=t},this.zoomIn=function(t){void 0===t&&(t=h()),I/=t},this.zoomOut=function(t){void 0===t&&(t=h()),I*=t},this.access=function(t,e,i){this.camera.position.x=this.player.position.x+t,this.camera.position.y=this.player.position.y+e,this.camera.position.z=this.player.position.z+i,this.camera.lookAt(this.player.position)},this.init=function(){"Speedy"==this.playerType?(this.moveSpeed=.17,this.maxSpeed=.4,this.turnSpeed=.1,this.sprintTurnSpeed=.03,this.acceleration=.007,this.staminaDrain=.3,this.staminaRecovery=.025,x=7,bulletSize=.1,m=2,c=24,y=3400,u=120,w=3,E=2):"Tank"==this.playerType?(this.moveSpeed=.12,this.maxSpeed=.25,this.turnSpeed=.05,this.sprintTurnSpeed=.04,this.acceleration=.004,this.staminaDrain=.1,this.staminaRecovery=.02,x=60,bulletSize=1,m=1.5,c=9,y=5400,u=45,w=3,E=2):(this.playerType="Assassin")&&(this.moveSpeed=.14,this.maxSpeed=.25,this.turnSpeed=.07,this.sprintTurnSpeed=.05,this.acceleration=.2,this.staminaDrain=.6,this.staminaRecovery=.1,x=120,bulletSize=.4,m=3.5,c=16,y=1600,u=72,w=3,E=2),v=this.moveSpeed,(d=new Gun(bulletSize,c,m,u)).init()},this.update=function(){this.checkKeyStates(),1==g.jump&&(R-=this.staminaDrain,d.bulletHeight=e.position.y+.5,T-=g.gravity,e.position.y+=T,t.position.y+=T,e.position.y<=.49&&(t.position.y=1,d.bulletHeight=1,e.position.y=.5,g.jumping=!1,g.jump=!1,T=.15)),M>0&&M--,this.center=this.player.position;var i=this.camera.position,o=i.clone().sub(this.center);f=Math.atan2(o.x,o.z);var s=Math.atan2(Math.sqrt(o.x*o.x+o.z*o.z),o.y);f+=A,s+=H,s=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,s)),s=Math.max(1e-6,Math.min(Math.PI-1e-6,s));var a=o.length()*I;a=Math.max(this.minDistance,Math.min(this.maxDistance,a)),o.x=a*Math.sin(s)*Math.sin(f),o.y=a*Math.cos(s),o.z=a*Math.sin(s)*Math.cos(f),this.autoRotate?(this.camera.position.x+=this.autoRotateSpeed*(this.player.position.x+this.perspective*Math.sin(this.player.rotation.y)-this.camera.position.x),this.camera.position.z+=this.autoRotateSpeed*(this.player.position.z+this.perspective*Math.cos(this.player.rotation.y)-this.camera.position.z)):i.copy(this.center).add(o),this.camera.lookAt(this.center),A=0,H=0,I=1,B===Z.NONE&&j?this.autoRotate=!0:this.autoRotate=!1,N.distanceTo(this.player.position)>0?N.copy(this.player.position):0==N.distanceTo(this.player.position)&&(j=!1)},this.checkKeyStates=function(){this.hasLanded?(this.allow&&(C[16]&&C[38]||C[87]&&C[16]?(R>0?(g.storeStaminaDelay=g.staminaDelay,R-=this.staminaDrain,a(),1==this.allowSprinting&&function(){g.moveSpeed<g.maxSpeed&&(g.moveSpeed+=g.acceleration),"Speedy"==g.playerType?g.turnSpeed=g.sprintTurnSpeed:(this.playerType,g.turnSpeed=g.sprintTurnSpeed)}()):(R=0,s()),this.sprinting=!0):(R<100&&(a(),this.allowSprinting=!0,R+=g.staminaRecovery),s()),(C[38]||C[87])&&(j=!0,this.player.position.x-=this.moveSpeed*Math.sin(this.player.rotation.y),this.player.position.z-=this.moveSpeed*Math.cos(this.player.rotation.y),this.camera.position.x-=this.moveSpeed*Math.sin(this.player.rotation.y),this.camera.position.z-=this.moveSpeed*Math.cos(this.player.rotation.y)),(C[40]||C[83])&&(j=!0,this.player.position.x+=this.moveSpeed*Math.sin(this.player.rotation.y),this.player.position.z+=this.moveSpeed*Math.cos(this.player.rotation.y),this.camera.position.x+=this.moveSpeed*Math.sin(this.player.rotation.y),this.camera.position.z+=this.moveSpeed*Math.cos(this.player.rotation.y)),C[81]&&(j=!0,this.player.position.x-=this.moveSpeed*Math.cos(this.player.rotation.y)/2,this.player.position.z+=this.moveSpeed*Math.sin(this.player.rotation.y)/2,this.camera.position.x-=this.moveSpeed*Math.cos(this.player.rotation.y)/2,this.camera.position.z+=this.moveSpeed*Math.sin(this.player.rotation.y)/2),C[69]&&(j=!0,this.player.position.x+=this.moveSpeed*Math.cos(this.player.rotation.y)/2,this.player.position.z-=this.moveSpeed*Math.sin(this.player.rotation.y)/2,this.camera.position.x+=this.moveSpeed*Math.cos(this.player.rotation.y)/2,this.camera.position.z-=this.moveSpeed*Math.sin(this.player.rotation.y)/2),C[70]&&0==g.jumping&&(g.jump=!0,this.jumping=!0),C[192]?(e.material.opacity>.5&&(e.material.opacity-=.05),j=!0,this.turnSpeed=.02,this.perspective>w&&(this.perspective-=.3),C[49]?(this.turnSpeed=.01,e.material.opacity>.2&&(e.material.opacity-=.01),this.perspective>E&&(this.perspective-=.1)):(e.material.opacity<.49&&(e.material.opacity+=.01),this.perspective<w-.1&&(this.perspective+=.1))):(e.material.opacity<1&&(e.material.opacity+=.05),this.perspective<7&&(j=!0,this.perspective+=.3)),C[32]&&0==M&&0==d.reloadStatus&&(d.shoot(f,x),M=x),C[82]&&(0==d.allowReload()&&0==d.reloadStatus?(z.classList.add("shake"),setTimeout(function(){bulletCountDisplay.classList.remove("shake")},500)):1==d.allowReload()&&0==d.reloadStatus&&d.reload(y))),C[77]?(mapView.width=window.innerWidth-200,mapView.height=window.innerHeight-100,mapView.x=window.innerWidth/2-(window.innerWidth-200)/2,mapView.y=window.innerHeight/2-(window.innerHeight-100)/2,mapPos.x=0,mapPos.y=1.2*arenaSize,mapPos.z=0,dimBack=!0,this.allow=!1):(mapView.width=200,mapView.height=200,mapView.x=window.innerWidth-220,mapView.y=20,mapPos.x=e.position.x,mapPos.y=70,mapPos.z=e.position.z,dimBack=!1,this.allow=!0)):mapCamera.lookAt(e.position),this.allow&&((C[37]||C[65])&&(j=!0,this.player.rotation.y+=this.turnSpeed),(C[39]||C[68])&&(j=!0,this.player.rotation.y-=this.turnSpeed)),ref.child(playerId).child("orientation").update({position:{x:this.player.position.x,y:this.player.position.y,z:this.player.position.z},rotation:{x:this.player.rotation.x,y:this.player.rotation.y,z:this.player.rotation.z},takeDamage:!1})},this.domElement.addEventListener("contextmenu",function(t){t.preventDefault()},!1),this.domElement.addEventListener("keydown",function(t){t=t||window.event,C[t.keyCode||t.which]=!0},!1),this.domElement.addEventListener("keyup",function(t){t=t||window.event,C[t.keyCode||t.which]=!1},!1),this.domElement.addEventListener("mousedown",function(t){!1!==g.enabled&&!1!==g.userRotate&&(t.preventDefault(),0===t.button?(B=Z.ROTATE,b.set(t.clientX,t.clientY)):1===t.button&&(B=Z.ZOOM,V.set(t.clientX,t.clientY)),document.addEventListener("mousemove",p,!1),document.addEventListener("mouseup",r,!1))},!1),this.domElement.addEventListener("mousewheel",l,!1),this.domElement.addEventListener("DOMMouseScroll",l,!1)},THREE.PlayerControls.prototype=Object.create(THREE.EventDispatcher.prototype);