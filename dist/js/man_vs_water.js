THREE.HarryControls=function(e,t,s,a){this.camera=e,this.player=t,this.domElement=void 0!==a?a:document,this.allow=!0,this.playerType=s.type,this.center=new THREE.Vector3(t.position.x,t.position.y,t.position.z),this.hasLanded=!1,this.sprinting=!1,this.allowSprinting=!0,this.jumping=!1,this.jump=!1,this.gravity=.007,this.allowMouseControls,this.health=s.health,this.stamina=100;let i=10,n=(s.bulletSpeed,s.reloadSpeed,s.moveSpeed),o=s.turnSpeed,l=s.scopeZoom,r=s.dblScopeZoom,d=.15;this.moveSpeed=s.moveSpeed,this.maxSpeed=s.maxSpeed,this.turnSpeed=s.turnSpeed,this.sprintTurnSpeed=s.sprintTurnSpeed,this.acceleration=s.acceleration,this.staminaDrain=s.staminaDrain,this.staminaRecovery=s.staminaRecovery;const m=document.getElementById("bulletCountDisplay");this.reloading=!1,this.userZoom=!0,this.userZoomSpeed=1,this.perspective=7,this.userRotate=!0,this.userRotateSpeed=1.5,this.autoRotate=!1,this.autoRotateSpeed=.3,this.YAutoRotation=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minDistance=0,this.maxDistance=1/0;var p,h=this,u=(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2,new THREE.Vector2,new THREE.Vector2,new THREE.Vector2,0),c=0,y=1,g=new THREE.Vector3(t.position.x,t.position.y,t.position.z),w=!1,S={},v=-1,E=v;this.rotateLeft=(e=>{void 0===e&&(e=b()),c-=e}),this.rotateRight=(e=>{void 0===e&&(e=b()),c+=e}),this.rotateUp=(e=>{void 0===e&&(e=b()),u-=e}),this.rotateDown=(e=>{void 0===e&&(e=b()),u+=e}),this.zoomIn=(e=>{void 0===e&&(e=M()),y/=e}),this.zoomOut=(e=>{void 0===e&&(e=M()),y*=e}),this.access=((e,t,s)=>{this.camera.position.x=this.player.position.x+e,this.camera.position.y=this.player.position.y+t,this.camera.position.z=this.player.position.z+s,this.camera.lookAt(this.player.position)}),this.init=(()=>{(gun=new Gun).init()}),this.update=(()=>{this.checkKeyStates(),1==h.jump&&(h.stamina-=this.staminaDrain,s.bulletHeight=t.position.y+.5,d-=h.gravity,t.position.y+=d,e.position.y+=d,t.position.y<=.49&&(e.position.y=1,s.bulletHeight=1,t.position.y=.5,h.jumping=!1,h.jump=!1,d=.15)),i>0&&i--,this.center=this.player.position;var a=this.camera.position,n=a.clone().sub(this.center);p=Math.atan2(n.x,n.z);var o=Math.atan2(Math.sqrt(n.x*n.x+n.z*n.z),n.y);p+=c,o+=u,o=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,o)),o=Math.max(1e-6,Math.min(Math.PI-1e-6,o));var l=n.length()*y;l=Math.max(this.minDistance,Math.min(this.maxDistance,l)),n.x=l*Math.sin(o)*Math.sin(p),n.y=l*Math.cos(o),n.z=l*Math.sin(o)*Math.cos(p),this.autoRotate?(this.camera.position.x+=this.autoRotateSpeed*(this.player.position.x+this.perspective*Math.sin(this.player.rotation.y)-this.camera.position.x),this.camera.position.z+=this.autoRotateSpeed*(this.player.position.z+this.perspective*Math.cos(this.player.rotation.y)-this.camera.position.z)):a.copy(this.center).add(n),this.camera.lookAt(this.center),c=0,u=0,y=1,this.autoRotate=!(E!==v||!w),g.distanceTo(this.player.position)>0?g.copy(this.player.position):0==g.distanceTo(this.player.position)&&(w=!1)}),this.checkKeyStates=function(){if(this.hasLanded){if(this.allow){if(S[16]&&S[38]||S[87]&&S[16]?h.stamina>0&&this.allowSprinting?(h.stamina-=this.staminaDrain,updateStamina(),k(),this.sprinting=!0):(h.stamina=0,f(),this.sprinting=!1):(h.stamina<100&&(updateStamina(),this.allowSprinting=!0,h.stamina+=h.staminaRecovery),f()),(S[38]||S[87])&&(w=!0,this.player.position.x-=this.moveSpeed*Math.sin(this.player.rotation.y),this.player.position.z-=this.moveSpeed*Math.cos(this.player.rotation.y),this.camera.position.x-=this.moveSpeed*Math.sin(this.player.rotation.y),this.camera.position.z-=this.moveSpeed*Math.cos(this.player.rotation.y)),(S[40]||S[83])&&(w=!0,this.player.position.x+=this.moveSpeed*Math.sin(this.player.rotation.y),this.player.position.z+=this.moveSpeed*Math.cos(this.player.rotation.y),this.camera.position.x+=this.moveSpeed*Math.sin(this.player.rotation.y),this.camera.position.z+=this.moveSpeed*Math.cos(this.player.rotation.y)),S[81]&&(w=!0,this.player.position.x-=this.moveSpeed*Math.cos(this.player.rotation.y)/2,this.player.position.z+=this.moveSpeed*Math.sin(this.player.rotation.y)/2,this.camera.position.x-=this.moveSpeed*Math.cos(this.player.rotation.y)/2,this.camera.position.z+=this.moveSpeed*Math.sin(this.player.rotation.y)/2),S[69]&&(w=!0,this.player.position.x+=this.moveSpeed*Math.cos(this.player.rotation.y)/2,this.player.position.z-=this.moveSpeed*Math.sin(this.player.rotation.y)/2,this.camera.position.x+=this.moveSpeed*Math.cos(this.player.rotation.y)/2,this.camera.position.z-=this.moveSpeed*Math.sin(this.player.rotation.y)/2),S[70]&&0==h.jumping&&h.stamina>20&&(h.jump=!0,this.jumping=!0),S[192]){if("man"==user.side)for(let e=0;e<5;e++)player.man_mats[e].opacity=.5;else player.player_mat.opacity=.5;if(w=!0,this.turnSpeed=.02,this.perspective>l&&(this.perspective-=.3),S[49]){if("man"==user.side)for(let e=0;e<5;e++)player.man_mats[e].opacity=.2;else player.player_mat.opacity=.2;this.turnSpeed=.005,this.perspective>r&&(this.perspective-=.1)}else{if("man"==user.side)for(let e=0;e<5;e++)player.man_mats[e].opacity=.5;else player.player_mat.opacity=.5;this.perspective<l-.1&&(this.perspective+=.1)}}else if(this.perspective<7&&(w=!0,this.perspective+=.3),"man"==user.side)for(let e=0;e<5;e++)player.man_mats[e].opacity=1;else player.player_mat.opacity=1;S[32]&&0==i&&0==gun.reloadStatus&&(gun.shoot(p,s.fireSpeed),i=s.fireSpeed),S[82]&&(gun.allowReload()||0!=gun.reloadStatus?gun.allowReload()&&0==gun.reloadStatus&&gun.reload():(m.classList.add("shake"),setTimeout(()=>{bulletCountDisplay.classList.remove("shake")},500)))}S[77]?(mapView.width=window.innerWidth-200,mapView.height=window.innerHeight-100,mapView.x=window.innerWidth/2-(window.innerWidth-200)/2,mapView.y=window.innerHeight/2-(window.innerHeight-100)/2,mapPos.x=t.position.x,mapPos.y=50,mapPos.z=t.position.z,dimBack=!0,this.allow=!1):(mapView.width=200,mapView.height=200,mapView.x=window.innerWidth-220,mapView.y=20,mapPos.x=t.position.x,mapPos.y=50,mapPos.z=t.position.z,dimBack=!1,this.allow=!0)}else mapCamera.lookAt(t.position);this.allow&&((S[37]||S[65])&&(w=!0,this.player.rotation.y+=this.turnSpeed),(S[39]||S[68])&&(w=!0,this.player.rotation.y-=this.turnSpeed)),ref.child(playerId).child("orientation").update({position:{x:this.player.position.x,y:this.player.position.y,z:this.player.position.z},rotation:{x:this.player.rotation.x,y:this.player.rotation.y,z:this.player.rotation.z}})};const f=()=>{this.moveSpeed>n&&(this.moveSpeed-=.01),this.turnSpeed<o&&(this.turnSpeed+=.01)},k=()=>{this.moveSpeed<this.maxSpeed&&(this.moveSpeed+=this.acceleration),this.turnSpeed>this.sprintTurnSpeed&&(this.turnSpeed-=.01)},b=()=>2*Math.PI/60/60*h.autoRotateSpeed,M=()=>Math.pow(.95,h.userZoomSpeed);this.domElement.addEventListener("contextmenu",e=>e.preventDefault()),this.domElement.addEventListener("keydown",e=>{e=e||window.event,S[e.keyCode||e.which]=!0}),this.domElement.addEventListener("keyup",e=>{e=e||window.event,S[e.keyCode||e.which]=!1})},THREE.HarryControls.prototype=Object.create(THREE.EventDispatcher.prototype);var gun,container=document.getElementById("container"),permission=document.getElementsByClassName("permission")[0],form=document.getElementsByClassName("form")[0],formName=document.getElementById("fname"),playerSelected=document.getElementsByClassName("form__wrapper__select")[0],playerTypes=document.getElementsByClassName("form__wrapper__select-opts"),formButton=document.getElementsByClassName("form__wrapper__button")[0],characterButton=document.getElementsByClassName("form__wrapper__button-character")[0],characters=document.getElementsByClassName("characters"),characterMan=document.getElementsByClassName("character__man")[0],characterWater=document.getElementsByClassName("character__water")[0],controls=document.getElementsByClassName("controls__panel")[0],rules=document.getElementsByClassName("rules__panel")[0],skinsMan=document.getElementsByClassName("manSkins"),skinsWater=document.getElementsByClassName("waterSkins"),customise=document.getElementsByClassName("form__customise")[0],settings=document.getElementsByClassName("form__settings")[0],backToCustomiseButton=document.getElementsByClassName("backToCustomise")[0],muteIcon=document.getElementsByClassName("muteStatus"),introAudio=new Audio("assets/audio/intro_music.mp3"),p5Sounds=[new Audio("assets/audio/thunder.m4a"),new Audio("assets/audio/thunder_2.mp3"),new Audio("assets/audio/wolf.mp3")],buttonAudio=new Audio("assets/audio/buttonAudio.mp3"),rain=new Audio("assets/audio/rain.mp3"),menu=document.getElementsByClassName("menu")[0],menuBig=document.getElementsByClassName("menu__noInteraction")[0],burger=document.getElementsByClassName("burger")[0],side=document.getElementsByClassName("side")[0],headphone=document.getElementsByClassName("headphone")[0],navigation=document.getElementsByClassName("navigation")[0],man=document.getElementsByClassName("man__player")[0],water=document.getElementsByClassName("water__player")[0],filter=document.getElementsByClassName("filter")[0],prevSkin=document.getElementById("prev"),nextSkin=document.getElementById("next"),lobby=document.getElementsByClassName("lobby")[0],manLobby=document.getElementsByClassName("man__final-player")[0],waterLobby=document.getElementsByClassName("water__final-player")[0],hit=null,feed=null,feedData=null,bulletCountDisplay=null,bulletCountAnimation=null,emptyGun=null,gunSupressor=null,sniper=null,shotgun=null,reloadPistol=null,totalPlayers=0,takeDamageAudio=null,healAudio=null,ammoAudio=null,staminaAudio=null,playersOnline=null;let chosenSideId,chosenPlayer,neglectedSideId,neglectedSide,playersJoined,otherPlayersExist,geo,mat,walls,grass,plane,texture,ambLights,sun,sky,lights,zone,environment,scope,playerId,player,arenaSizeSelected,arenaSize,meshShrinkSpeed,stats,gameStroke=null,skinIndex=0,permitAudio=!1,ifMapSelected=!1,menuStatus=!1,healthPerks=[],staminaPerks=[],ammoPerks=[],bullets=[],otherPlayers={},keys=[],shrinkSpeed=.01,user={},speedyStats={type:"speedy",health:80,damage:40,moveSpeed:.17,maxSpeed:.4,turnSpeed:.05,sprintTurnSpeed:.1,acceleration:.007,staminaDrain:.3,staminaRecovery:.025,fireSpeed:7,bulletSize:.1,bulletSpeed:1.8,magazineSize:24,reloadSpeed:3400,totalBullets:120,maxBullets:120,scopeZoom:3,dblScopeZoom:2,bulletHeight:1,visibility:70},assassinStats={type:"assassin",health:60,damage:280,moveSpeed:.14,maxSpeed:.25,turnSpeed:.06,sprintTurnSpeed:.05,acceleration:.2,staminaDrain:.6,staminaRecovery:.1,fireSpeed:120,bulletSize:.3,bulletSpeed:2,magazineSize:16,reloadSpeed:1600,totalBullets:72,maxBullets:72,scopeZoom:3,dblScopeZoom:1.5,bulletHeight:1,visibility:150},tankStats={type:"tank",health:95,damage:120,moveSpeed:.12,maxSpeed:.25,turnSpeed:.04,sprintTurnSpeed:.04,acceleration:.004,staminaDrain:.1,staminaRecovery:.02,fireSpeed:60,bulletSize:1,bulletSpeed:1.5,magazineSize:9,reloadSpeed:5400,totalBullets:45,maxBullets:45,scopeZoom:3,dblScopeZoom:2,bulletHeight:1,visibility:90};setTimeout(()=>{permission.classList.add("permissionIn"),garbage(filter)},5e3);const getThreeAssets=()=>{bulletCountDisplay=document.getElementById("bulletCountDisplay"),bulletCountAnimation=document.getElementsByClassName("bulletCountAnimation")[0],emptyGun=new Audio("assets/audio/emptyGun.m4a"),gunSupressor=new Audio("assets/audio/gun_supressor.m4a"),sniper=new Audio("assets/audio/Gun2.mp3"),shotgun=new Audio("assets/audio/Gun3.mp3"),reloadPistol=new Audio("assets/audio/reload_pistol.mp3"),playerSelected=document.getElementsByClassName("form__wrapper__select")[0],feed=document.getElementsByClassName("feed")[0],feedData=document.getElementsByClassName("feedData")[0],playersOnline=document.getElementsByClassName("playersOnline")[0],hit=document.getElementsByClassName("hit")[0],takeDamageAudio=new Audio("assets/audio/damage.mp3"),healAudio=new Audio("assets/audio/heal.mp3"),ammoAudio=new Audio("assets/audio/ammo.mp3"),staminaAudio=new Audio("assets/audio/stamina.mp3"),gameStroke=new THREE.MeshBasicMaterial({color:0,wireframe:!0}),clearRam()},clearRam=()=>{permission=null,form=null,formName=null,playerTypes=null,formButton=null,characterButton=null,characters=null,characterMan=null,characterWater=null,skinsMan=null,skinsWater=null,customise=null,settings=null,backToCustomiseButton=null,muteIcon=null,introAudio=null,p5Sounds=null,buttonAudio=null,side=null,headphone=null,navigation=null,man=null,water=null,prevSkin=null,nextSkin=null,controls=null,rules=null},garbage=e=>{null},clearHTML=e=>{e.innerHTML=""},removePermissionForm=e=>{permission.style.animation="yes"==e?"permissionOutYES .3s ease-in":"permissionOutNO .3s ease-in",side.classList.add("sideIn"),setTimeout(()=>{permission.style.display="none",form.style.opacity="1"},390),side.style.display="block"},openForm=e=>{user.side=e.currentTarget.id,neglectedSide="man"==user.side?"water":"man",chosenSideId=document.getElementById(e.currentTarget.id),neglectedSideId=document.getElementById(neglectedSide),chosenSideId.classList.add("selectSide"),neglectedSideId.classList.add("deSelectSide"),side.classList.add("decisionMade"),"man"==user.side?(form.style.left="60vw",characterMan.style.display="block"):(form.style.left="40vw",characterWater.style.display="block"),form.classList.remove("hideForm"),chosenSideId.addEventListener("click",returnToChoose)},returnToChoose=()=>{side.style.width="100vw",side.classList.remove("decisionMade"),chosenSideId.classList.remove("selectSide"),neglectedSideId.classList.remove("deSelectSide"),chosenSideId.removeEventListener("click",returnToChoose),form.classList.add("hideForm"),backToCustomise(),resetSkin(),characterMan.style.display="none",characterWater.style.display="none"},showMenuInfo=e=>{let t=e.currentTarget.id;controls.style.display="none",rules.style.display="none","controls"==t?controls.style.display="flex":rules.style.display="block"},allowAudio=e=>{"yes"==e.currentTarget.id?(playAudios(),permitAudio=!0,buttonAudio.play(),muteIcon[0].style.display="block",removePermissionForm("yes")):(removePermissionForm("no"),permitAudio=!1,muteIcon[1].style.display="block"),openBurgerMenu(),side.style.display="block",garbage(permission),clearHTML(permission)},validateForm=()=>{""==document.getElementById("fname").value?(showError("form__wrapper__input"),!ifMapSelected&&showError("form__wrapper__select-opts")):(user.name=formName.value,user.skin=skinIndex,form.style.display="none",removeListeners(),enterLobby())},enterLobby=()=>{document.getElementsByClassName("dev_-_enterGame")[0].style.display="flex",lobby.classList.add("lobbyIn"),side.style.display="none",stopP5(),pauseAudios(),headphone.style.display="none",displayFinalSkin()},enterGame=()=>{hideNavigation(),bulletCountDisplay=document.getElementById("bulletCountDisplay"),bulletCountAnimation=document.getElementsByClassName("bulletCountAnimation")[0],emptyGun=new Audio("assets/audio/emptyGun.m4a"),gunSupressor=new Audio("assets/audio/gun_supressor.m4a"),sniper=new Audio("assets/audio/Gun2.mp3"),shotgun=new Audio("assets/audio/Gun3.mp3"),reloadPistol=new Audio("assets/audio/reload_pistol.mp3"),playerSelected=document.getElementsByClassName("form__wrapper__select")[0],feed=document.getElementsByClassName("feed")[0],feedData=document.getElementsByClassName("feedData")[0],playersOnline=document.getElementsByClassName("playersOnline")[0],hit=document.getElementsByClassName("hit")[0],takeDamageAudio=new Audio("assets/audio/damage.mp3"),healAudio=new Audio("assets/audio/heal.mp3"),ammoAudio=new Audio("assets/audio/ammo.mp3"),staminaAudio=new Audio("assets/audio/stamina.mp3"),gameStroke=new THREE.MeshBasicMaterial({color:0,wireframe:!0}),clearRam(),document.getElementsByClassName("UI")[0].style.display="block",leaveLobby(),initThreeJs()},selectPlayer=e=>{let t=e.currentTarget.id;ifMapSelected=!0,clearPlayerSelections(),document.getElementById(t).getElementsByTagName("img")[0].classList.add("mapSelected"),showStats(stats="speedy"==t?speedyStats:"assassin"==t?assassinStats:tankStats)},clearPlayerSelections=()=>{for(var e=0;e<playerTypes.length;e++)playerTypes[e].getElementsByTagName("img")[0].classList.remove("mapSelected")},hideNavigation=()=>{navigation.style.display="none",form.style.display="none",side.style.display="none"},showError=e=>{let t=document.getElementsByClassName(e);for(let e=0;e<t.length;e++)t[e].style.animation=".1s error ease-in-out 3",setTimeout(()=>{t[e].style.animation="0"},90)},stopP5=()=>{container.removeChild(canvas);stopP5Draw=!0},playAudios=()=>{introAudio.play(),introAudio.loop=!0,rain.play(),rain.volume=.1,rain.loop=!0},pauseAudios=()=>{introAudio.pause(),rain.pause();for(var e=0;e<p5Sounds.length;e++)p5Sounds[e].pause()},changeAudioPermissions=e=>{"mute"==e.currentTarget.id?(muteIcon[0].style.display="none",muteIcon[1].style.display="block",permitAudio=!1,pauseAudios()):(muteIcon[0].style.display="block",muteIcon[1].style.display="none",permitAudio=!0,playAudios())},openBurgerMenu=()=>{menuStatus?(menuBig.classList.remove("openMenu"),burger.classList.remove("cross"),menuStatus=!1):(menuBig.classList.add("openMenu"),burger.classList.add("cross"),menuStatus=!0)},removeListeners=()=>{window.removeEventListener("keydown",validateForm,!1),formButton.removeEventListener("click",validateForm,!1)},toForm=()=>{customise.style.transform="translate3d(-100%, -50%, 0)",settings.style.transform="translate3d(0, -50%, 0)",backToCustomiseButton.style.display="block"},backToCustomise=()=>{customise.style.transform="translate3d(0, -50%, 0)",settings.style.transform="translate3d(100%, -50%, 0)",backToCustomiseButton.style.display="none",clearPlayerSelections(),clearStats(),formName.value="",stats=null},showStats=e=>{let t=document.getElementsByClassName("stat");t[0].style.transform="translate3d("+(e.health/1.5-100)+"%, 0, 0)",t[1].style.transform="translate3d("+(e.damage/3-100)+"%, 0, 0)",t[2].style.transform="translate3d("+(e.magazineSize/30*100-100)+"%, 0, 0)",t[3].style.transform="translate3d("+(e.reloadSpeed/100-100)+"%, 0, 0)",t[4].style.transform="translate3d("+-e.fireSpeed/150*100+"%, 0, 0)",t[5].style.transform="translate3d("+(100*(e.moveSpeed+e.maxSpeed+e.acceleration)-100)+"%, 0, 0)"},clearStats=()=>{let e=document.getElementsByClassName("stat");for(let t=0;t<e.length;t++)e[t].style.transform="translate3d(-50%, 0, 0)"},scrollSkin=e=>{let t=e.currentTarget.id;"next"==t&&skinIndex<2?skinIndex++:"prev"==t&&skinIndex>0&&skinIndex--,0==skinIndex?prev.classList.add("noScroll"):2==skinIndex?next.classList.add("noScroll"):(prev.classList.remove("noScroll"),next.classList.remove("noScroll")),showSkin(skinIndex)},resetSkin=()=>{skinIndex=0,prev.classList.add("noScroll"),next.classList.remove("noScroll"),showSkin(skinIndex)},showSkin=e=>{let t;t=0==e?"50px":1==e?"-250px":"-550px",characters[0].style.transform="translate3d("+t+", 0, 0)",characters[1].style.transform="translate3d("+t+", 0, 0)"},leaveLobby=()=>{document.getElementsByClassName("dev_-_enterGame")[0].style.display="none",lobby.classList.remove("lobbyIn")},displayFinalSkin=()=>{"man"==user.side?(manLobby.style.background='url("assets/SVG/man_skin'+skinIndex+'_front.svg")',waterLobby.style.display="none"):(manLobby.style.display="none",waterLobby.style.background='url("assets/SVG/water_skin'+skinIndex+'_front.svg")')};function Particle(e,t){this.pos=createVector(e,t),this.vel=createVector(0,15),this.lavaBounce=createVector(10*Math.random()-5,-25),this.isLava=!1,this.update=((e,t)=>{this.pos.add(this.vel),this.vel.x>0&&(this.vel.x-=e),this.vel.x>=10&&(this.vel.x=10),this.resetPos()}),this.show=(e=>{this.isLava?(noStroke(),fill(255,90,40,80),ellipse(this.pos.x,this.pos.y,5*e,5*e)):(noFill(),strokeWeight(e),stroke(255,40),line(this.pos.x,this.pos.y,this.pos.x,this.pos.y+20))}),this.applyWind=(e=>{this.vel.add(Math.floor(Math.random()*e)+5,0)}),this.resetPos=(()=>{this.pos.y>=window.innerHeight&&!this.isLava?this.isLava=!0:this.pos.y>=window.innerHeight&&this.isLava&&(this.pos.y=0,this.pos.x=Math.floor(Math.random()*window.innerWidth),this.vel.y=Math.floor(Math.random()*rainSpeed)+8,this.isLava=!1,this.lavaBounce=createVector(10*Math.random()-5,-25)),this.pos.x>window.innerWidth?this.pos.x=0:this.pos.x<0&&(this.pos.x=window.innerWidth),this.isLava&&(this.pos.add(this.lavaBounce),this.lavaBounce.mult(.97))})}formButton.addEventListener("click",validateForm,!1),window.addEventListener("keydown",e=>{13!=e.keyCode&&13!=e.which||validateForm()},!1);let p,g_color1,g_color2,particles=[],stopP5Draw=!1,rainIntensity=60,dropThickness=1,thunderFrequency=300,windSpeed=5,airFriction=.05,rainSpeed=10;function setup(){var e=createCanvas(window.innerWidth,window.innerHeight);g_color1=color(7,0,12),g_color2=color(255,120,70),e.parent(container),particles=[];for(let e=0;e<300;e++)particles[e]=new Particle(Math.floor(Math.random()*window.innerWidth),-Math.floor(Math.random()*window.innerHeight))}function draw(){if(stopP5Draw&&noLoop(),setGradient(0,0,window.innerWidth,window.innerHeight,g_color1,g_color2),1==Math.floor(Math.random()*thunderFrequency)){background(200,200,200);for(var e=0;e<rainIntensity;e++)particles[e].applyWind(windSpeed);if(1==permitAudio){var t=Math.floor(3*Math.random());p5Sounds[t].play(),p5Sounds[t].volume=2==t?.1:.5}}for(e=0;e<rainIntensity;e++)particles[e].update(airFriction,rainSpeed),particles[e].show(dropThickness)}function setGradient(e,t,s,a,i,n){noFill();for(var o=t;o<=t+a;o++){var l=map(o,t,t+a,0,.4),r=lerpColor(i,n,l);stroke(r),line(e,o,e+s,o)}}window.addEventListener("resize",function(){resizeCanvas(window.innerWidth,window.innerHeight)});const setAudioPara=()=>{overlapSounds(gunSupressor),overlapSounds(takeDamageAudio),reloadPistol.volume=.2,healAudio.volume=.1,healAudio.playbackRate=2,ammoAudio.volume=.2,staminaAudio.volume=.1,staminaAudio.playbackRate=4,emptyGun.volume=.2,sniper.volume=.2,shotgun.volume=.2},overlapSounds=e=>{e.preload="auto",e.load()};let oscillate=0;const regulatePerks=()=>{let e=new THREE.SphereGeometry(.1,6,6);if(healthPerks.length<7){let t=new THREE.MeshBasicMaterial({color:14699082}),s=new THREE.Mesh(e,t);s.position.set(Math.random()*arenaSize-arenaSize/2,.05,Math.random()*arenaSize-arenaSize/2),scene.add(s),healthPerks.push(s)}if(staminaPerks.length<7){let t=new THREE.MeshBasicMaterial({color:5144541}),s=new THREE.Mesh(e,t);s.position.set(Math.random()*arenaSize-arenaSize/2,.05,Math.random()*arenaSize-arenaSize/2),scene.add(s),staminaPerks.push(s)}if(ammoPerks.length<7){let t=new THREE.MeshBasicMaterial({color:16777215}),s=new THREE.Mesh(e,t);s.position.set(Math.random()*arenaSize-arenaSize/2,.05,Math.random()*arenaSize-arenaSize/2),scene.add(s),ammoPerks.push(s)}pickPerks()},oscillatePerks=()=>{let e=player.mesh.position.x,t=player.mesh.position.z;for(let s in healthPerks){let a=healthPerks[s].position.x,i=healthPerks[s].position.z,n=e-a<.6&&e-a>-.6&&t-i<.6&&t-i>-.6;healthPerks[s].position.y=Math.sin(oscillate)/4+.4,n&&pickPerks(s,"health")}for(let s in staminaPerks){let a=staminaPerks[s].position.x,i=staminaPerks[s].position.z,n=e-a<.6&&e-a>-.6&&t-i<.6&&t-i>-.6;staminaPerks[s].position.y=Math.sin(oscillate)/4+.4,n&&pickPerks(s,"stamina")}for(let s in ammoPerks){let a=ammoPerks[s].position.x,i=ammoPerks[s].position.z,n=e-a<.6&&e-a>-.6&&t-i<.6&&t-i>-.6;ammoPerks[s].position.y=Math.sin(oscillate)/4+.4,n&&pickPerks(s,"ammo")}oscillate+=.08},pickPerks=(e,t)=>{"health"==t?controls.health<stats.health&&(controls.health<stats.health-10?(controls.health+=10,controls.health/stats.health>.4&&(document.getElementsByClassName("damage")[0].style.opacity=0)):controls.health=stats.health,updateHealth(),scene.remove(healthPerks[e]),healthPerks.splice(e,1),healAudio.play()):"stamina"==t?controls.stamina<100&&(controls.stamina<90?controls.stamina+=10:controls.stamina=100,scene.remove(staminaPerks[e]),updateStamina(),staminaPerks.splice(e,1),staminaAudio.play()):"ammo"==t&&stats.totalBullets<stats.maxBullets&&(stats.totalBullets<stats.maxBullets-5?stats.totalBullets+=5:stats.totalBullets=stats.maxBullets,bulletCountDisplay.innerHTML=gun.bulletCount+1+" /"+stats.totalBullets,scene.remove(ammoPerks[e]),ammoPerks.splice(e,1),ammoAudio.play())};var player_geo,Zone=function(){var e=this;this.init=function(){this.height=400,geo=new THREE.BoxGeometry(arenaSize,this.height,arenaSize,5,5),mat=new THREE.MeshBasicMaterial({color:7389652,side:THREE.DoubleSide,transparent:!0,opacity:.3}),e.mesh=new THREE.Mesh(geo,mat),e.mesh.position.y=this.height/2-1,scene.add(e.mesh)}},Player=function(e,t,s,a){this.playerId=e,this.username=t,this.isMainPlayer=!1,this.mesh,this.playerType=stats.type,this.player_mat,this.skin=s,this.chosenSide=a,this.man_mats,scope=this,this.init=(()=>{"man"==this.chosenSide?(player_geo=new THREE.BoxBufferGeometry(1,1,1),scope.man_mats=[new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load("assets/SVG/man_skin"+this.skin+"_right.svg"),transparent:!0,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load("assets/SVG/man_skin"+this.skin+"_left.svg"),transparent:!0,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load("assets/SVG/man_skin"+this.skin+"_top.svg"),transparent:!0,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load("assets/SVG/man_skin"+this.skin+"_bottom.svg"),transparent:!0,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load("assets/SVG/man_skin"+this.skin+"_back.svg"),transparent:!0,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load("assets/SVG/man_skin"+this.skin+"_front.svg"),transparent:!0,side:THREE.DoubleSide})],scope.player_mat=new THREE.MeshFaceMaterial(scope.man_mats)):(scope.player_mat=new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load("assets/SVG/water_skin"+this.skin+".svg"),transparent:!0,side:THREE.DoubleSide}),player_geo=new THREE.SphereGeometry(.5,15,15)),scope.mesh=new THREE.Mesh(player_geo,scope.player_mat),scope.meshBorder=new THREE.Mesh(player_geo,gameStroke),"man"==user.side?scope.mesh.position.set(10-arenaSize/2,arenaSize/2,Math.random()*arenaSize-arenaSize/2):scope.mesh.position.set(arenaSize/2-10,arenaSize/2,Math.random()*arenaSize-arenaSize/2),scope.mesh.add(scope.meshBorder),scene.add(scope.mesh),scope.isMainPlayer&&(controls=new THREE.HarryControls(camera,scope.mesh,stats))}),this.setOrientation=((e,t)=>{scope.mesh&&(scope.mesh.position.copy(e),scope.mesh.rotation.y=t)}),this.restrict=(e=>{let t=arenaSize/2-.5;e.position.x=e.position.x<=-t?-t:e.position.x>=t?t:e.position.x,e.position.z=e.position.z<=-t?-t:e.position.z>=t?t:e.position.z})},Wall=function(e,t,s){this.list=[],this.posList=[],this.downloadStatus=!1;var a,i,n,o,l,r=this;this.init=(()=>{if(i=new THREE.MeshPhongMaterial({color:7285804}),this.downloadStatus)setTimeout(()=>{for(let e=0;e<this.posList.length;e++)o=this.posList[e].h,a=new THREE.BoxGeometry(3,o,3,3,3,3),n=new THREE.Mesh(a,i),l=new THREE.Mesh(a,gameStroke),n.position.set(this.posList[e].x,this.posList[e].h/2,this.posList[e].z),this.list.push(n),n.add(l),scene.add(n)},300);else for(let s=0;s<e;s++)o=Math.floor(Math.random()*t+3),a=new THREE.BoxGeometry(3,o,3,3,3,3),n=new THREE.Mesh(a,i),l=new THREE.Mesh(a,gameStroke),n.position.set(arenaSize/2-Math.floor(Math.random()*arenaSize),o/2,arenaSize/2-Math.floor(Math.random()*arenaSize)),this.list.push(n),this.posList[s]={x:n.position.x,y:n.position.y,z:n.position.z,h:o},n.add(l),scene.add(n)}),this.applyPhysics=(e=>{var t=s.position.x,a=s.position.z;e=e;1==controls.sprinting&&(e*=2);for(let i in this.list)t-this.list[i].position.x<=2&&t-this.list[i].position.x>=-2&&a-this.list[i].position.z<=2&&a-this.list[i].position.z>=-2&&(t-this.list[i].position.x<=0?s.position.x-=e:t-this.list[i].position.x>=0&&(s.position.x+=e),a-this.list[i].position.z<=0?s.position.z-=e:a-this.list[i].position.z>=0&&(s.position.z+=e))}),this.upload=(()=>{for(let e in this.posList)gameRef.child("Obstacles").child(e).set({x:this.posList[e].x,y:this.posList[e].y,z:this.posList[e].z,h:this.posList[e].h}),this.downloadStatus=!1}),this.download=(()=>{gameRef.child("Obstacles").on("value",e=>{for(let t in e.val())r.posList[t]=e.val()[t]}),this.downloadStatus=!0})},Grass=function(e,t){var s,a,i,n,o,l=this;this.list=[],this.posList=[],this.downloadStatus=!1,this.init=(()=>{if(a=new THREE.MeshPhongMaterial({color:3896911}),1==this.downloadStatus)setTimeout(()=>{for(let e=0;e<this.posList.length;e++)n=this.posList[e].h,s=new THREE.BoxGeometry(3,n,3,3,3,3),i=new THREE.Mesh(s,a),o=new THREE.Mesh(s,gameStroke),i.position.set(this.posList[e].x,this.posList[e].h/2,this.posList[e].z),this.list.push(i),i.add(o),scene.add(i)},300);else for(let l=0;l<e;l++)n=Math.floor(Math.random()*t+3),s=new THREE.BoxGeometry(3,n,3,3,3,3),i=new THREE.Mesh(s,a),o=new THREE.Mesh(s,gameStroke),i.position.set(arenaSize/2-Math.floor(Math.random()*arenaSize),n/2,arenaSize/2-Math.floor(Math.random()*arenaSize)),this.list.push(i),this.posList[l]={x:i.position.x,y:i.position.y,z:i.position.z,h:n},i.add(o),scene.add(i)}),this.upload=(()=>{for(let e in this.posList)gameRef.child("Bushes").child(e).set({x:this.posList[e].x,y:this.posList[e].y,z:this.posList[e].z,h:this.posList[e].h}),this.downloadStatus=!1}),this.download=(()=>{gameRef.child("Bushes").on("value",e=>{for(let t in e.val())l.posList[t]=e.val()[t]}),this.downloadStatus=!0})};class Gun{constructor(){this.reloadStatus=!1,this.bullet_geo=new THREE.SphereGeometry(stats.bulletSize,10,10),this.bullet_mat=new THREE.MeshBasicMaterial({color:16777215}),this.bullet=new THREE.Mesh(this.bullet_geo,this.bullet_mat),this.bulletCount=stats.magazineSize-1}init(){bulletCountDisplay.innerHTML=this.bulletCount+1+" / "+stats.totalBullets;for(var e=0;e<stats.magazineSize;e++)bullets[e]=this.bullet.clone(),bullets[e].position.set(0,-5,0),scene.add(bullets[e])}shoot(e){this.bulletCount>=0?(this.gunSound(),bullets[this.bulletCount].position.set(player.mesh.position.x,stats.bulletHeight,player.mesh.position.z),bullets[this.bulletCount].velocity=new THREE.Vector3(-Math.sin(e),0,-Math.cos(e)),bullets[this.bulletCount].velocity.x*=stats.bulletSpeed,bullets[this.bulletCount].velocity.z*=stats.bulletSpeed,bullets[this.bulletCount].alive=!0,this.bulletCount--,bulletCountDisplay.innerHTML=this.bulletCount+1+" /"+stats.totalBullets):(emptyGun.play(),this.ammoError())}gunSound(){let e=gunSupressor.cloneNode();"speedy"==stats.type?(e.volume=.05,e.play()):"assassin"==stats.type?(sniper.playbackRate=2.5,sniper.play()):"tank"==stats.type&&(shotgun.playbackRate=120/stats.fireSpeed,shotgun.play())}reload(){stats.totalBullets>0&&(this.animateReloadButton(stats.reloadSpeed),this.reloadStatus=!0,reloadPistol.playbackRate=1e3/stats.reloadSpeed*2,reloadPistol.play(),setTimeout(()=>{bulletCountAnimation.style.animation="",stats.magazineSize-this.bulletCount<=stats.totalBullets?(stats.totalBullets-=stats.magazineSize-this.bulletCount-1,this.bulletCount=stats.magazineSize-1):stats.magazineSize-this.bulletCount>stats.totalBullets&&(this.bulletCount+=stats.totalBullets,stats.totalBullets=0),bulletCountDisplay.innerHTML=this.bulletCount+1+" /"+stats.totalBullets,bullets.reverse(),this.reloadStatus=!1},stats.reloadSpeed))}allowReload(){return this.bulletCount!=stats.magazineSize-1}animateReloadButton(){bulletCountAnimation.style.animation="reload "+stats.reloadSpeed/1e3+"s linear"}ammoError(){bulletCountDisplay.classList.add("shake"),setTimeout(function(){bulletCountDisplay.classList.remove("shake")},300)}}const bulletPhysics=e=>{for(let a in bullets){for(let i in e){var t=bullets[a].position.x,s=bullets[a].position.z;if(bullets[a].position.y>0){let t=e[i].position.x-bullets[a].position.x,s=e[i].position.z-bullets[a].position.z;t<=1.5+stats.bulletSize&&t>=-(1.5+stats.bulletSize)&&s<=1.5+stats.bulletSize&&s>=-(1.5+stats.bulletSize)&&(bullets[a].position.set(0,-5,0),bullets[a].alive=!1)}}if((bullets[a].position.x<-arenaSize/2||bullets[a].position.x>arenaSize/2||bullets[a].position.z<-arenaSize/2||bullets[a].position.z>arenaSize/2)&&(bullets[a].position.set(0,-5,0),bullets[a].alive=!1),bullets[a].alive&&bullets[a].position.add(bullets[a].velocity),bullets[a].alive)for(let e in keys){let i=keys[e],n=otherPlayers[i].mesh.position,o=.5+stats.bulletSize;t-n.x<o&&t-n.x>-o&&s-n.z<o&&s-n.z>-o&&(giveDamage(i),bullets[a].position.set(0,-5,0),bullets[a].alive=!1)}}},loadGround=()=>{geo=new THREE.PlaneGeometry(4*arenaSize,4*arenaSize,arenaSize/4,arenaSize/4),mat=new THREE.MeshPhongMaterial({color:2236962}),(plane=new THREE.Mesh(geo,mat)).receiveShadow=!0,plane.rotation.x=-Math.PI/2,scene.add(plane)},addLights=()=>{ambLight=new THREE.AmbientLight(16777215,1),(sun=new THREE.SpotLight(16777215)).intensity=1,sun.penumbra=1,sun.position.set(player.mesh.position.x,200,player.mesh.position.z),sun.lookAt(player.mesh.position),sun.castShadow=!0,sun.shadowDarkness=.5,sun.shadowCameraVisible=!0,scene.add(ambLight),scene.add(sun)};zone=new Zone;var Environment=function(){this.init=(()=>{ambLight=new THREE.AmbientLight(16777215,1),(sun=new THREE.SpotLight(16777215)).intensity=1,sun.penumbra=1,sun.position.set(player.mesh.position.x,200,player.mesh.position.z),sun.lookAt(player.mesh.position),sun.castShadow=!0,sun.shadowDarkness=.5,sun.shadowCameraVisible=!0,scene.add(ambLight),scene.add(sun),geo=new THREE.PlaneGeometry(4*arenaSize,4*arenaSize,arenaSize/4,arenaSize/4),mat=new THREE.MeshPhongMaterial({color:2236962}),(plane=new THREE.Mesh(geo,mat)).receiveShadow=!0,plane.rotation.x=-Math.PI/2,scene.add(plane),zone.init(),walls=new Wall(Math.floor(arenaSize/2),5,player.mesh),grass=new Grass(arenaSize/2,1),getMap()})};const checkOtherPlayers=()=>new Promise(e=>{ref.on("value",t=>{otherPlayersExist=t.numChildren()>1,e("resolved")})});async function getMap(){await checkOtherPlayers();otherPlayersExist?(walls.download(),grass.download(),walls.init(),grass.init()):(walls.init(),grass.init(),walls.upload(),grass.upload())}const updateHealth=()=>{let e=document.getElementsByClassName("health")[0];e.style.borderLeft=controls.health/stats.health*300+"px solid #e04a4a",e.style.transform="scale(1.2)",setTimeout(()=>{e.style.transform="scale(1)"},500)};var updateStamina=()=>{let e=document.getElementsByClassName("stamina")[0];e.style.borderLeft=controls.stamina/100*300+"px solid #4e7fdd",controls.stamina<99?e.style.transform="scale(.9)":e.style.transform="scale(1)"};const recieveDamage=()=>{ref.child(playerId).child("orientation").child("takeDamage").on("value",e=>{1==e.val()&&(ref.child(playerId).child("orientation").child("damageType").once("value").then(e=>{inflictDamage(e.val())}),ref.child(playerId).child("orientation").update({takeDamage:!1,damageType:0}))})},inflictDamage=e=>{let t=takeDamageAudio.cloneNode();t.volume=.1,t.play();let s="tank"==e?tankStats.damage:"assassin"==e?assassinStats.damage:speedyStats.damage;controls.health-=s/10,updateHealth();let a=document.getElementsByClassName("damage")[0];a.style.transition="0s",a.style.opacity=.3,setTimeout(()=>{a.style.transition="opacity .8s",controls.health/stats.health<=.4?a.style.opacity=.2:a.style.opacity=0},500),conclude()},giveDamage=e=>{ref.child(e).child("orientation").update({takeDamage:!0,damageType:stats.type,damageFrom:playerId}),displayHit()},dyingInfo=()=>{ref.child(playerId).child("orientation").child("damageFrom").once("value").then(e=>(ref.child(e.val()).child("orientation").update({kill:user.name,killKey:playerId}),new Promise(e=>{e()})))};async function terminate(){await dyingInfo(),gameOver("loose"),ref.child(playerId).remove(),cancelAnimationFrame(animate)}const conclude=()=>{controls.health<=0&&terminate()},displayHit=()=>{hit.style.transition="opacity .2s",hit.style.opacity=1,setTimeout(()=>{hit.style.transition="0",hit.style.opacity=0},1e3)};environment=new Environment;var Game=function(){this.init=function(){overlapSounds(gunSupressor),overlapSounds(takeDamageAudio),reloadPistol.volume=.2,healAudio.volume=.1,healAudio.playbackRate=2,ammoAudio.volume=.2,staminaAudio.volume=.1,staminaAudio.playbackRate=4,emptyGun.volume=.2,sniper.volume=.2,shotgun.volume=.2,loadMapsize(),initMainPlayer(),initOtherPlayer(),environment.init(),controls.init(),removePlayer(),checkKills()},this.update=function(){regulatePerks(),oscillatePerks(),playerFall(),walls.applyPhysics(.2),bulletPhysics(walls.list),player.restrict(player.mesh)}};const listenToPlayer=e=>{e.val()&&otherPlayers[e.key].setOrientation(e.val().orientation.position,e.val().orientation.rotation.y)},initOtherPlayer=()=>{ref.on("child_added",e=>{e.val()&&(totalPlayers+=1,updateTotalPlayers(),playerId==e.key||otherPlayers[e.key]||(otherPlayers[e.key]=new Player(e.key,e.val().orientation.userInfo.name,e.val().orientation.playerInfo.skin,e.val().orientation.playerInfo.chosenSide),otherPlayers[e.key].init(),ref.child(e.key).on("value",listenToPlayer),keys.push(e.key),addFeed("new player has joined: ",e.val().orientation.userInfo.name)))}),ref.on("child_removed",e=>{if(e.val()){ref.child(playerId).child("orientation").child("killKey").once("value").then(t=>{t.val()!=e.key&&addFeed("a player has left: ",e.val().orientation.userInfo.name)}),totalPlayers-=1,updateTotalPlayers(),ref.child(e.key).off("value",listenToPlayer),scene.remove(otherPlayers[e.key].mesh),delete otherPlayers[e.key];for(let t in keys)keys[t]==e.key&&keys.splice(t,1)}})},initMainPlayer=()=>{playerId=ref.push().key,ref.child(playerId).child("orientation").set({position:{x:0,y:0,z:0},rotation:{y:0},userInfo:{name:user.name},playerInfo:{skin:skinIndex,chosenSide:user.side,playerType:stats.type},takeDamage:!1,damageFrom:0,damageType:0,kill:0,killKey:0}),(player=new Player(playerId,user.name,user.skin,user.side)).isMainPlayer=!0,player.init(),ref.child(playerId).child("orientation").child("takeDamage").on("value",e=>{1==e.val()&&(ref.child(playerId).child("orientation").child("damageType").once("value").then(e=>{inflictDamage(e.val())}),ref.child(playerId).child("orientation").update({takeDamage:!1,damageType:0}))})},loadMapsize=()=>{meshShrinkSpeed=shrinkSpeed/(arenaSize=150)},removePlayer=()=>{window.onunload=(()=>ref.child(playerId).remove()),window.onbeforeunload=(()=>ref.child(playerId).remove()),window.onoffline=(()=>ref.child(playerId).remove())},playerFall=()=>{controls.hasLanded||player.mesh.position.y>1&&(controls.update(),controls.access(4,.5,4),player.mesh.position.y--,player.mesh.position.y<=2&&(player.mesh.position.y=.5,controls.access(4,.5,4),controls.hasLanded=!0))};var addFeed=(e,t)=>{feed.style.display="flex",feed.style.opacity=1,feedData.innerHTML=e+' <span class="feedImp">'+t+"</span>",feedData.style.animation="feedIn .4s ease-out",feedData.style.animationFillMode="forwards",setTimeout(()=>{feedData.style.animation="feedOut .4s ease-out",feedData.style.animationFillMode="forwards",feed.style.opacity=0},1500),setTimeout(()=>{feed.style.display="none",feedData.innerHTML=""},2300)};const updateTotalPlayers=()=>{playersOnline.innerHTML="Players online: "+totalPlayers},checkKills=()=>{ref.child(playerId).child("orientation").child("kill").on("value",e=>{0!=e.val()&&addFeed("you just killed",e.val())})};var canvas,scene,camera,mapCamera,renderer,dimBack,mapSize,game=new Game,mapPos={x:0,y:50,z:0},mapView={width:200,height:200,x:window.innerWidth-220,y:20};const init=()=>{canvas=document.getElementById("container"),scene=new THREE.Scene,mapCamera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1e3),(camera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1e3)).position.z=0,camera.rotation.order="YXZ",(renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0})).setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement),window.addEventListener("resize",()=>{camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)},!1),document.body.appendChild(container)},animate=()=>{controls&&controls.update(),game.update(),render(),requestAnimationFrame(animate)},render=()=>{dimBack&&dimLight(),renderer.setViewport(0,0,window.innerWidth,window.innerHeight),renderer.setClearColor(16777215,0),scene.fog=new THREE.Fog(723732,.01,stats.visibility),renderer.render(scene,camera),renderer.autoClear=!1,fullLight(),renderer.clearDepth(),renderer.setViewport(mapView.x,mapView.y,mapView.width,mapView.height),mapCamera.aspect=mapView.width/mapView.height,mapCamera.updateProjectionMatrix(),mapCamera.position.set(mapPos.x,mapPos.y,mapPos.z),renderer.render(scene,mapCamera)},initThreeJs=()=>{canvas=document.getElementById("container"),scene=new THREE.Scene,mapCamera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1e3),(camera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1e3)).position.z=0,camera.rotation.order="YXZ",(renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0})).setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement),window.addEventListener("resize",()=>{camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)},!1),document.body.appendChild(container),game.init(),mapPos.x=player.mesh.position.x,mapPos.z=player.mesh.position.z,animate()},dimLight=()=>{ambLight.intensity=.2,sun.intensity=.2},fullLight=()=>{ambLight.intensity=1,sun.intensity=1};let flushStatInterval,facts=document.getElementsByClassName("facts"),leakStat=1.1264,flushStat=0,skullCount=0,inc=.1;const displayOutcome=()=>{startFlushStat(),document.getElementsByClassName("outcome")[0].classList.add("outcomeIn")};setInterval(()=>{facts[0].getElementsByTagName("h2")[0].innerHTML=leakStat<1e3?Math.round(100*leakStat)/100+"<span>ml</span>":Math.round(leakStat)/1e3+"<span>L</span>",leakStat+=1.1264},1e3),setInterval(()=>{if(++skullCount<100){let e=document.createElement("IMG");e.src="assets/SVG/dead.svg",e.alt="skull",e.className="fatality__skull",document.getElementsByClassName("fatality")[0].appendChild(e)}else if(100==skullCount){let e=document.createElement("P");e.innerHTML=" x"+skullCount,e.className="multiplier",document.getElementsByClassName("fatality")[0].appendChild(e),once=!1}else document.getElementsByClassName("multiplier")[0].innerHTML=" x"+skullCount},37450);const showFlushStat=()=>{flushStat<71.2?(flushStat+=inc-=7e-5,facts[1].getElementsByTagName("h2")[0].innerHTML=Math.round(100*flushStat)/100+"<span>L</span>"):(flushStat=71.2,clearInterval(flushStatInterval))},startFlushStat=()=>{flushStatInterval=setInterval(showFlushStat)};async function gameOver(e){await gameOverCinematic(e);document.getElementsByClassName("damage")[0].style.display="none",displayOutcome()}const gameOverCinematic=e=>{let t=document.getElementsByClassName("filter")[0];return"win"==e&&t.classList.add("pan"),new Promise(e=>e())},test=()=>{let e=document.getElementsByClassName("filter")[0];e.style.display="block",e.style.opacity="1"};